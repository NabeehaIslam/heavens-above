name: ðŸ“š Documentation Deployment

on:
  push:
    branches:
      - main
      - master
    paths:
      - 'docs/'
      - 'README.md'
      - '*.md'
  workflow_dispatch:

permissions:
  contents: write
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build-documentation:
    name: Build Documentation
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ§© Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: âš™ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ðŸ“¦ Install Dependencies
        run: |
          npm install
          npm install --save-dev marked highlight.js

      - name: ðŸ— Build Documentation Site
        run: |
          echo "ðŸ“ Generating documentation..."
          mkdir -p docs/assets/css docs/assets/js
          # (rest of your build script unchanged)
          # ...
          echo "âœ… Documentation built successfully!"

      - name: ðŸ“‹ Generate README Documentation
        run: |
          # (your existing README conversion script here)

      - name: ðŸ” Validate Documentation Build
        run: |
          if [ ! -f "docs/index.html" ]; then
            echo "âŒ index.html not found!"
            exit 1
          fi
          echo "âœ… Documentation validation passed"

      - name: ðŸ“ Generate Build Metadata
        run: |
          cat > docs/build-info.json << EOF
          {
            "build_date": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "commit_sha": "$(git rev-parse HEAD)",
            "branch": "$(git rev-parse --abbrev-ref HEAD)"
          }
          EOF

      - name: ðŸ“¤ Upload Documentation Artifact
        uses: actions/upload-artifact@v4
        with:
          name: documentation-build-${{ github.run_number }}
          path: docs/
          retention-days: 30

      - name: ðŸ“‹ Create Build Summary
        run: |
          echo "# ðŸ“š Documentation Build Summary" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Build successful!" >> $GITHUB_STEP_SUMMARY

  deploy-netlify:
    name: ðŸš€ Deploy to Netlify
    needs: build-documentation
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Download Documentation Artifact
        uses: actions/download-artifact@v4
        with:
          name: documentation-build-${{ github.run_number }}
          path: docs/

      - name: ðŸ”§ Install Netlify CLI
        run: npm install -g netlify-cli

      - name: ðŸš€ Deploy to Netlify
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
        run: |
          netlify deploy --dir=docs --prod --message "Docs build ${{ github.run_number }}"

      - name: âœ… Deployment Summary
        run: |
          echo "# ðŸš€ Netlify Deployment Summary" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Deployment successful" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“… $(date -u +%Y-%m-%d\ %H:%M:%S\ UTC)" >> $GITHUB_STEP_SUMMARY
