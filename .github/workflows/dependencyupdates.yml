name: 🔄 Dependency Update Monitor

on:
  workflow_dispatch:        # ✅ allows manual trigger from GitHub UI
  schedule:
    - cron: '0 0 * * 0'     # ✅ runs every Sunday at midnight (UTC)

permissions:
  contents: write
  issues: write

jobs:
  dependency-check:
    name: Check for Dependency Updates
    runs-on: ubuntu-latest

    steps:
      - name: 🧩 Checkout Repository
        uses: actions/checkout@v4

      - name: ⚙️ Install jq (for JSON parsing)
        run: sudo apt-get install jq -y

      - name: 🔍 Check Latest Version of Cypress (example dependency)
        id: check_version
        run: |
          echo "Fetching latest Cypress release..."
          curl -s https://api.github.com/repos/cypress-io/cypress/releases/latest > latest.json
          latest_version=$(jq -r '.tag_name' latest.json)
          echo "Latest Cypress version: $latest_version"
          echo "version=$latest_version" >> $GITHUB_OUTPUT

      - name: 🧾 Create Issue for Detected Update
        uses: peter-evans/create-issue-from-file@v5
        with:
          title: "📦 Dependency Update: Cypress ${{ steps.check_version.outputs.version }}"
          content-filepath: ./latest.json
          labels: "automation, dependency-update"
          assignees: ${{ github.actor }}

      - name: ✅ Summary
        run: echo "Dependency update check completed successfully!"
