name: 📚 Documentation Deployment

on:
  push:
    branches: [main, master]
    paths:
      - 'docs/**'
      - '*.md'
      - 'README.md'
  workflow_dispatch:

permissions:
  contents: write
  pages: write
  id-token: write

concurrency:
  group: "pages-docs"
  cancel-in-progress: false

jobs:
  build-and-deploy-docs:
    name: 🏗 Build & Deploy Documentation
    runs-on: ubuntu-latest
    environment:
      name: github-pages

    steps:
      - name: 🧩 Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ⚙ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: 📦 Install Dependencies
        run: |
          npm install
          npm install --save-dev marked highlight.js

      - name: 🏗 Generate Documentation
        run: |
          echo "📝 Generating HTML documentation..."
          mkdir -p docs/assets/css docs/assets/js

          cat > docs/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>Heavens Above - Documentation</title>
              <style>
                  body { font-family: system-ui, sans-serif; line-height: 1.6; background: #f7f9fc; padding: 20px; }
                  .container { max-width: 900px; margin: auto; background: white; border-radius: 10px; box-shadow: 0 4px 30px rgba(0,0,0,0.1); padding: 40px; }
                  h1 { color: #2a5298; }
              </style>
          </head>
          <body>
              <div class="container">
                  <h1>🛰 Heavens Above Documentation</h1>
                  <p>Generated on BUILD_DATE</p>
                  <hr>
                  <div id="readme-content">
                      README_CONTENT
                  </div>
              </div>
          </body>
          </html>
          EOF

          BUILD_DATE=$(date -u +"%Y-%m-%d %H:%M:%S UTC")

          # Inject README.md content into the page
          if [ -f "README.md" ]; then
            README_CONTENT=$(cat README.md | sed 's/&/\&amp;/g; s/</\&lt;/g; s/>/\&gt;/g')
            sed -i "s|README_CONTENT|$README_CONTENT|g" docs/index.html
          fi

          sed -i "s|BUILD_DATE|$BUILD_DATE|g" docs/index.html

      - name: 🔧 Setup GitHub Pages
        uses: actions/configure-pages@v4

      - name: 📦 Upload Pages Artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: docs/

      - name: 🚀 Deploy to GitHub Pages
        id: deploy
        uses: actions/deploy-pages@v4
